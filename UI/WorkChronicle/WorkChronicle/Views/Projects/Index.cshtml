@{
    ViewData["Title"] = "Projects";
}
@model WorkChronicle.ViewModels.ProjectListViewModel

<div class="row mt-4">
    <h1 id="page-title">Projects</h1>
</div>

<div id="project-page" class="row">
    <div class="col-12">
        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#exampleModal">
            Add new Project
        </button>
    </div>

    <div class="col-12">
        
        <div class="row mt-3" style="padding: 5px 0px;">
            <div class="col-3"><b>Project Name</b></div>
            <div class="col-3"><b>Status</b></div>
            <div class="col-6"></div>
        </div>

        @foreach (var project in Model.Projects)
        {
            <div class="row" style="border-top: 1px solid #d1d1d1; padding: 5px 0px;">
                <div class="col-3">@project.Name</div>
                <div class="col-3">
                    @if (project.ProjectStatusId == 1)
                    {
                        <span>Active</span>
                    }
                    else
                    {
                        <span>Deactivated</span>
                    }
                </div>
                <div class="col-6 d-flex justify-content-end">
                    <a class="btn btn-sm btn-primary btn-settings mr-3" asp-action="EditProject" asp-route-id="@project.Id">Edit</a>
                    @if (project.ProjectStatusId == 1)
                    {
                        <a class="btn btn-sm btn-danger btn-settings mr-3" asp-action="DeactivateProject" asp-route-id="@project.Id">Deactivate</a>
                    }
                    else
                    {
                        <a class="btn btn-sm btn-primary btn-settings mr-3" asp-action="ActivateProject" asp-route-id="@project.Id">Activate</a>
                    }
                    <a class="btn btn-sm btn-danger btn-settings" asp-action="DeleteProject" asp-route-id="@project.Id">Delete</a>
                </div>
            </div>
        }
    </div>
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create project</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input class="w-100" id="project-name-input" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id="btn-create-project" type="button" class="btn btn-primary">Create project</button>
            </div>
        </div>
    </div>
</div>


<script>
    $("#btn-create-project").on("click", function (e) {
        const data = {
            ProjectName: $("#project-name-input").val()
        };

        $.ajax({
            url: "/Projects/CreateProject",
            type: "POST",
            data: data,
            dataType: "json",
            success: (response) => {
                $('#exampleModal').modal('hide');

                if (response.success) {
                    alert("Project was created successfully!");
                }

                location.reload();
            },
            error: () => alert("Something went wront!")
        });
    });

</script>